package com.dio.atividade;

import com.bringto.selenium.DriverFactory;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.util.List;

public class AmazonBrasil {
    public static void main(String[] args) {
        WebDriver driver = null;

        try {
            driver = DriverFactory.getDriver();

            driver.get("https://www.amazon.com.br/");

            WebDriverWait wait = new WebDriverWait(driver, 15);
            WebElement campoBusca = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//input[@id=\"twotabsearchtextbox\"]")));

            campoBusca.sendKeys("headset");
            driver.findElement(By.xpath("//input[@id=\"nav-search-submit-button\"]")).click();

            wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//div[@data-component-type='s-search-result']")));

            List<WebElement> produtos = driver.findElements(By.xpath("//div[@data-component-type='s-search-result']"));

            System.out.println("-----PRODUTOS-----");
            for (int i = 0; i < Math.min(20, produtos.size()); i++) {
                WebElement produtoCard = produtos.get(i);

                String nome = produtoCard.findElement(By.xpath(".//h2[@class=\"a-size-base-plus a-spacing-none a-color-base a-text-normal\"]")).getText();

                String preco = "IndisponÃ­vel";
                try {
                    preco = produtoCard.findElement(By.xpath(".//span[@class=\"a-price-whole\"]")).getText();

                } catch (Exception e) {
                }
                System.out.println((i + 1) + " = " + nome + " | R$: " + preco);
            }
        } finally {
            if (driver != null) {
                driver.quit();
            }
        }
    }
}

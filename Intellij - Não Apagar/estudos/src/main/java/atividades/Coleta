package com.bringto.informacao;

import com.bringto.selenium.TelaHelper;
import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import com.opencsv.CSVWriter;

import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStreamWriter;
import java.io.Writer;
import java.nio.charset.StandardCharsets;
import java.util.List;

public class Coleta {

    public static void main(String[] args) {

        try {
            TelaHelper.navegar("https://ayltoninacio.com.br/blog/tabela-cores-html-css-hexadecimal-nome-rgb");
            TelaHelper.maximizar();

            WebElement tabela = TelaHelper.esperarVisibilidade(By.xpath("//table[1]"), 10);

            List<WebElement> linhas = tabela.findElements(By.xpath(".//tr"));

            String caminhoArquivo = "tabela_cores.csv";
            File arquivo = new File(caminhoArquivo);

            try (
                    Writer writer = new OutputStreamWriter(new FileOutputStream(arquivo), StandardCharsets.UTF_8);
                    CSVWriter csvWriter = new CSVWriter(writer)
            ) {
                for (WebElement linha : linhas) {
                    // Primeiro tenta encontrar <th>, senão tenta <td>
                    List<WebElement> colunas = linha.findElements(By.xpath(".//th"));
                    if (colunas.isEmpty()) {
                        colunas = linha.findElements(By.xpath(".//td"));
                    }

                    String[] dados = new String[colunas.size()];
                    for (int i = 0; i < colunas.size(); i++) {
                        dados[i] = colunas.get(i).getText().trim();
                    }

                    csvWriter.writeNext(dados);
                }

                System.out.println("✅ Arquivo '" + arquivo.getAbsolutePath() + "' criado com sucesso!");
            }

        } catch (Exception e) {
            System.err.println("❌ Erro durante a execução:");
            e.printStackTrace();
        } finally {
            TelaHelper.finalizar();
        }
    }
}
